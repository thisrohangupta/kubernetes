name: Deploy Service
on:
  push:
    branches:
      - main
jobs:
  deployment:
    runs-on: ubuntu-latest
    environment: dev
    name: Deploy Nginx
    steps:
    - name: Service Setup
      run: |
        echo "Service Name: Nginx"
        echo "Artifact Tag: Latest"
    - name: Dynamic Provisioned Infrastructure - K8s Cluster
      uses: medyagh/setup-minikube@master
    - name: Fetch Files
      uses: actions/checkout@v2
    - name: Prepare Manifest
      uses: yukitsune/template-cli@v0.1.0
      with:
        args: --input deployment.yaml \
          --value "name=nginx" \
          --output .
    - name: Apply
      run: |
        kubectl apply -f deployment.yaml       
    - name: Wait for Steady State Check
      run: |
        minikube service list
        kubectl describe deployment.apps/nginx
